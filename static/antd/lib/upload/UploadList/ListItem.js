"use strict";var _interopRequireWildcard=require("@babel/runtime/helpers/interopRequireWildcard").default,_interopRequireDefault=require("@babel/runtime/helpers/interopRequireDefault").default;Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _extends2=_interopRequireDefault(require("@babel/runtime/helpers/extends")),_defineProperty2=_interopRequireDefault(require("@babel/runtime/helpers/defineProperty")),_slicedToArray2=_interopRequireDefault(require("@babel/runtime/helpers/slicedToArray")),_DeleteOutlined=_interopRequireDefault(require("@ant-design/icons/DeleteOutlined")),_DownloadOutlined=_interopRequireDefault(require("@ant-design/icons/DownloadOutlined")),_EyeOutlined=_interopRequireDefault(require("@ant-design/icons/EyeOutlined")),_classnames=_interopRequireDefault(require("classnames")),_rcMotion=_interopRequireDefault(require("rc-motion")),React=_interopRequireWildcard(require("react")),_configProvider=require("../../config-provider"),_progress=_interopRequireDefault(require("../../progress")),_tooltip=_interopRequireDefault(require("../../tooltip")),ListItem=React.forwardRef((function(_ref,ref){var _classNames3,_a,_b,prefixCls=_ref.prefixCls,className=_ref.className,style=_ref.style,locale=_ref.locale,listType=_ref.listType,file=_ref.file,items=_ref.items,progressProps=_ref.progress,iconRender=_ref.iconRender,actionIconRender=_ref.actionIconRender,itemRender=_ref.itemRender,isImgUrl=_ref.isImgUrl,showPreviewIcon=_ref.showPreviewIcon,showRemoveIcon=_ref.showRemoveIcon,showDownloadIcon=_ref.showDownloadIcon,customPreviewIcon=_ref.previewIcon,customRemoveIcon=_ref.removeIcon,customDownloadIcon=_ref.downloadIcon,onPreview=_ref.onPreview,onDownload=_ref.onDownload,onClose=_ref.onClose,status=file.status,_React$useState=React.useState(status),_React$useState2=(0,_slicedToArray2.default)(_React$useState,2),mergedStatus=_React$useState2[0],setMergedStatus=_React$useState2[1];React.useEffect((function(){"removed"!==status&&setMergedStatus(status)}),[status]);var _React$useState3=React.useState(!1),_React$useState4=(0,_slicedToArray2.default)(_React$useState3,2),showProgress=_React$useState4[0],setShowProgress=_React$useState4[1],progressRafRef=React.useRef();React.useEffect((function(){return progressRafRef.current=setTimeout((function(){setShowProgress(!0)}),300),function(){window.clearTimeout(progressRafRef.current)}}),[]);var spanClassName="".concat(prefixCls,"-span"),iconNode=iconRender(file),icon=React.createElement("div",{className:"".concat(prefixCls,"-text-icon")},iconNode);if("picture"===listType||"picture-card"===listType)if("uploading"===mergedStatus||!file.thumbUrl&&!file.url){var _classNames,uploadingClassName=(0,_classnames.default)((_classNames={},(0,_defineProperty2.default)(_classNames,"".concat(prefixCls,"-list-item-thumbnail"),!0),(0,_defineProperty2.default)(_classNames,"".concat(prefixCls,"-list-item-file"),"uploading"!==mergedStatus),_classNames));icon=React.createElement("div",{className:uploadingClassName},iconNode)}else{var _classNames2,thumbnail=(null==isImgUrl?void 0:isImgUrl(file))?React.createElement("img",{src:file.thumbUrl||file.url,alt:file.name,className:"".concat(prefixCls,"-list-item-image"),crossOrigin:file.crossOrigin}):iconNode,aClassName=(0,_classnames.default)((_classNames2={},(0,_defineProperty2.default)(_classNames2,"".concat(prefixCls,"-list-item-thumbnail"),!0),(0,_defineProperty2.default)(_classNames2,"".concat(prefixCls,"-list-item-file"),isImgUrl&&!isImgUrl(file)),_classNames2));icon=React.createElement("a",{className:aClassName,onClick:function onClick(e){return onPreview(file,e)},href:file.url||file.thumbUrl,target:"_blank",rel:"noopener noreferrer"},thumbnail)}var message,infoUploadingClass=(0,_classnames.default)((_classNames3={},(0,_defineProperty2.default)(_classNames3,"".concat(prefixCls,"-list-item"),!0),(0,_defineProperty2.default)(_classNames3,"".concat(prefixCls,"-list-item-").concat(mergedStatus),!0),(0,_defineProperty2.default)(_classNames3,"".concat(prefixCls,"-list-item-list-type-").concat(listType),!0),_classNames3)),linkProps="string"==typeof file.linkProps?JSON.parse(file.linkProps):file.linkProps,removeIcon=showRemoveIcon?actionIconRender(("function"==typeof customRemoveIcon?customRemoveIcon(file):customRemoveIcon)||React.createElement(_DeleteOutlined.default,null),(function(){return onClose(file)}),prefixCls,locale.removeFile):null,downloadIcon=showDownloadIcon&&"done"===mergedStatus?actionIconRender(("function"==typeof customDownloadIcon?customDownloadIcon(file):customDownloadIcon)||React.createElement(_DownloadOutlined.default,null),(function(){return onDownload(file)}),prefixCls,locale.downloadFile):null,downloadOrDelete="picture-card"!==listType&&React.createElement("span",{key:"download-delete",className:(0,_classnames.default)("".concat(prefixCls,"-list-item-card-actions"),{picture:"picture"===listType})},downloadIcon,removeIcon),listItemNameClass=(0,_classnames.default)("".concat(prefixCls,"-list-item-name")),preview=file.url?[React.createElement("a",(0,_extends2.default)({key:"view",target:"_blank",rel:"noopener noreferrer",className:listItemNameClass,title:file.name},linkProps,{href:file.url,onClick:function onClick(e){return onPreview(file,e)}}),file.name),downloadOrDelete]:[React.createElement("span",{key:"view",className:listItemNameClass,onClick:function onClick(e){return onPreview(file,e)},title:file.name},file.name),downloadOrDelete],previewIcon=showPreviewIcon?React.createElement("a",{href:file.url||file.thumbUrl,target:"_blank",rel:"noopener noreferrer",style:file.url||file.thumbUrl?void 0:{pointerEvents:"none",opacity:.5},onClick:function onClick(e){return onPreview(file,e)},title:locale.previewFile},"function"==typeof customPreviewIcon?customPreviewIcon(file):customPreviewIcon||React.createElement(_EyeOutlined.default,null)):null,actions="picture-card"===listType&&"uploading"!==mergedStatus&&React.createElement("span",{className:"".concat(prefixCls,"-list-item-actions")},previewIcon,"done"===mergedStatus&&downloadIcon,removeIcon);message=file.response&&"string"==typeof file.response?file.response:(null===(_a=file.error)||void 0===_a?void 0:_a.statusText)||(null===(_b=file.error)||void 0===_b?void 0:_b.message)||locale.uploadError;var iconAndPreview=React.createElement("span",{className:spanClassName},icon,preview),rootPrefixCls=(0,React.useContext(_configProvider.ConfigContext).getPrefixCls)(),dom=React.createElement("div",{className:infoUploadingClass},React.createElement("div",{className:"".concat(prefixCls,"-list-item-info")},iconAndPreview),actions,showProgress&&React.createElement(_rcMotion.default,{motionName:"".concat(rootPrefixCls,"-fade"),visible:"uploading"===mergedStatus,motionDeadline:2e3},(function(_ref2){var motionClassName=_ref2.className,loadingProgress="percent"in file?React.createElement(_progress.default,(0,_extends2.default)({},progressProps,{type:"line",percent:file.percent})):null;return React.createElement("div",{className:(0,_classnames.default)("".concat(prefixCls,"-list-item-progress"),motionClassName)},loadingProgress)}))),listContainerNameClass=(0,_classnames.default)("".concat(prefixCls,"-list-").concat(listType,"-container"),className),item="error"===mergedStatus?React.createElement(_tooltip.default,{title:message,getPopupContainer:function getPopupContainer(node){return node.parentNode}},dom):dom;return React.createElement("div",{className:listContainerNameClass,style,ref},itemRender?itemRender(item,file,items,{download:onDownload.bind(null,file),preview:onPreview.bind(null,file),remove:onClose.bind(null,file)}):item)})),_default=ListItem;exports.default=_default;